---
title: "Disability Employment"
output: 
  html_notebook:
    code_folding: hide
---

Disability Employment Awareness
B18120 Employment Status by Disability Status and Type (Civilian Noninstitutionalized Population 18 to 64 Years)
<!-- B18121 Work Experience by Disability Status and Type -->
<!-- B18130 Age by Disability Status by Poverty Status -->

[Census Stats](https://www.census.gov/newsroom/stories/disability-employment-awareness-month.html)

The charts include the coefficient of variation (CV) measures which is the relative amount of sampling error that is associated with a sample estimate. See [this article](https://psrc.github.io/psrccensus/articles/calculate-reliability-moe-transformed-acs.html) for interpretation.

```{r}
library(psrccensus)
library(psrcplot)
library(tidyverse)
library(tidycensus)
library(DT)
```

```{r B18120 Employment Status}
x <- get_acs_recs('county', table.names = 'B18120', years = '2022', acs.type = 'acs1')

x02 <- x %>% 
  mutate(variable_sort = str_extract(variable, "\\d{2}$")) %>% 
  mutate(label02 = label) %>% 
  separate(label02,
           sep = ":!!",
           into = c('total', 'in_lf', 'is_emp', 'has_dis', 'dis_type')) %>%
  mutate(dis_type = ifelse(variable_sort %in% 23:28, has_dis, dis_type)) %>%
  mutate(has_dis = ifelse(variable_sort %in% 22:29, is_emp, has_dis)) %>%
  mutate(is_emp = ifelse(variable_sort %in% 22:29, NA, is_emp)) %>% 
  mutate(in_lf = str_replace_all(in_lf, ":", ""),
         is_emp = str_replace_all(is_emp, ":", ""),
         has_dis = str_replace_all(has_dis, ":", ""))
```

```{r region}
  
r <- x02 %>% 
  filter(name == 'Region')
```

## Disability in Region (as a whole)

```{r region with disability}
w_dis <- c('04', '13', '22')
wo_dis <- c('11', '20', '29')

r_tot <- r %>% 
  filter(variable_sort == '01') %>% 
  select(name, denom_est = estimate, denom_moe = moe)

r_dis <- r %>%
  filter(variable_sort %in% c(w_dis, wo_dis)) %>% 
  group_by(name, has_dis) %>%
  summarise(estimate = sum(estimate),
            moe = moe_sum(moe = moe, estimate = estimate)) %>%
  mutate(se = moe/1.645) %>% 
  mutate(cv = (se/estimate)) %>% 
  left_join(r_tot, by = 'name') %>% 
  mutate(share_est = estimate/denom_est,
         share_moe = moe_prop(estimate, denom_est, moe, denom_moe))

r_dis_fmt <- r_dis %>% 
  select(-se, -denom_est, -denom_moe)

datatable(r_dis_fmt)%>%
  formatRound(columns=c('estimate'), digits = 0) %>% 
  formatRound(columns=c('moe', 'cv'), digits = 2) %>% 
  formatPercentage(c(5, 6,7), 1)
  
```

- 9.7% of people in the Central Puget Sound Region between the ages of 18-64 report having a disability 

### Disability types

```{r region disability types}

#4, 13, 22 "With disability" total

r_dis_type_denom <- r %>% 
  filter(variable_sort == '01') %>% 
  group_by(name) %>% 
  summarise(denom_est = sum(estimate),
            denom_moe = moe_sum(moe = moe, estimate = estimate))

r_dis_type <- r %>% 
  filter(has_dis == 'With a disability') %>% 
  filter(!(variable_sort %in% c('04', '13', '22'))) %>% # 444,261 
  group_by(name, dis_type) %>%
  summarise(estimate = sum(estimate),
            moe = moe_sum(moe = moe, estimate = estimate)) %>% 
  mutate(se = moe/1.645) %>% 
  mutate(cv = (se/estimate)) %>% 
  left_join(r_dis_type_denom, by = 'name') %>% 
  mutate(share_est = estimate/denom_est,
         share_moe = moe_prop(estimate, denom_est, moe, denom_moe))

r_dis_type_fmt <- r_dis_type %>% 
  select(-se, -denom_est, -denom_moe)

datatable(r_dis_type_fmt)%>%
  formatRound(columns=c('estimate'), digits = 0) %>% 
  formatRound(columns=c('moe'), digits = 2) %>% 
  formatPercentage(c(5, 6,7), 1)

```

* Individuals can report more than one disability. Aggregating all disability types will not equal the reported 'With a disability' totals.

- Most individuals in the region with a disability report at least a cognitive difficulty followed by independent living difficulty, and an ambulatory difficulty

## Within the Labor Force


```{r in labor force with disability}
# in labor force, emp/ump, with a disability

r_lf_emp_dis_denom <- r %>%
  filter(variable_sort %in% c('01', '02')) %>%
  mutate(label02 = label) %>% 
  mutate(label02 = str_replace_all(label02, ".*In the labor force.*", "in_lf"),
         label02 = str_replace_all(label02, ".*Total.*", "reg_tot")) %>% 
  pivot_wider(id_cols = c('name'),
              names_from = 'label02',
              names_glue = "denom_{label02}_{.value}",
              values_from = c('estimate', 'moe'))
  
lf_rows <- c('04', '11', '13', '20')

r_lf_emp_dis <- r %>% 
  filter(variable_sort %in% lf_rows) %>% 
  mutate(se = moe/1.645) %>% 
  mutate(cv = (se/estimate)) %>% 
  left_join(r_lf_emp_dis_denom, by = 'name') %>% 
  mutate(share_est_reg = estimate/denom_reg_tot_estimate,
         share_moe_reg = moe_prop(estimate, denom_reg_tot_estimate, moe, denom_reg_tot_moe),
         share_est_inlf = estimate/denom_in_lf_estimate,
         share_moe_inlf = moe_prop(estimate, denom_in_lf_estimate, moe, denom_in_lf_moe))
  
r_lf_emp_dis_fmt <- r_lf_emp_dis %>% 
  select(name, in_lf, is_emp, has_dis, estimate, moe, cv, starts_with('share'))

datatable(r_lf_emp_dis_fmt) %>%
  formatRound(columns=c('estimate'), digits = 0) %>% 
  formatRound(columns=c('moe'), digits = 2) %>% 
  formatPercentage(7:11, 1)


```

Of those in the labor force

- 6.3% (approx 139,000 persons) with a disability are employed
- Individuals with a disability and unemployed represent 0.6% (12,700 persons) of the labor force

## Not in the Labor Force
```{r not in labor force with disability}
# NOT in labor force, with a disability

r_not_lf_dis_denom <- r %>%
  filter(variable_sort %in% c('01', '21')) %>%
  mutate(label02 = label) %>% 
  mutate(label02 = str_replace_all(label02, ".*Not in labor force.*", "in_lf"),
         label02 = str_replace_all(label02, ".*Total.*", "reg_tot")) %>% 
  pivot_wider(id_cols = 'name',
              names_from = 'label02',
              names_glue = "denom_{label02}_{.value}",
              values_from = c('estimate', 'moe'))
  
not_lf_rows <- c('22', '29')

r_not_lf_dis <- r %>% 
  filter(variable_sort %in% not_lf_rows) %>% 
  mutate(se = moe/1.645) %>% 
  mutate(cv = (se/estimate)) %>% 
  left_join(r_not_lf_dis_denom, by = 'name') %>% 
  mutate(share_est_reg = estimate/denom_reg_tot_estimate,
         share_moe_reg = moe_prop(estimate, denom_reg_tot_estimate, moe, denom_reg_tot_moe),
         share_est_inlf = estimate/denom_in_lf_estimate,
         share_moe_inlf = moe_prop(estimate, denom_in_lf_estimate, moe, denom_in_lf_moe))
  
r_not_lf_dis_fmt <- r_not_lf_dis %>% 
  select(name, in_lf, is_emp, has_dis, estimate, moe, cv, starts_with('share'))

datatable(r_not_lf_dis_fmt) %>%
  formatRound(columns=c('estimate'), digits = 0) %>% 
  formatRound(columns=c('moe'), digits = 2) %>% 
  formatPercentage(7:11, 1)


```

<!-- X% are not in in the labor force -->

- Of those not in the labor force, 21.8% percent report a disability 

## Work Experience by Disability Status and Type

```{r B18121 Work Experience by Disability Status and Type}
we <- get_acs_recs('county', table.names = 'B18121', years = '2022', acs.type = 'acs1')

we02 <- we %>%
  mutate(variable_sort = str_extract(variable, "\\d{2}$")) %>%
  mutate(label02 = label) %>%
  separate(label02,
           sep = ":!!",
           into = c('total', 'duration', 'has_dis', 'dis_type')) %>%
  mutate(duration = str_replace_all(duration, ":", ""),
         has_dis = str_replace_all(has_dis, ":", ""))
```

```{r}

r_we <- we02 %>% 
  filter(name == 'Region')

exc_we_rows <- c('01', '02', '11', '12', '20', '21')

r_we_denom <- r_we %>% 
  filter(variable_sort %in% '01') %>% 
  select(name, denom_est = estimate, denom_moe = moe)
```

```{r}


r_we_grp <- r_we %>% 
  filter(!(variable_sort %in% exc_we_rows)) %>% 
  mutate(is_wrk = ifelse(str_detect(duration, "Worked.*"), "Worked", "Not Worked")) %>% 
  group_by(name, is_wrk, has_dis) %>% 
  summarise(estimate = sum(estimate),
            moe = moe_sum(moe = moe, estimate = estimate)) %>% 
  mutate(se = moe/1.645) %>% 
  mutate(cv = (se/estimate)) %>% 
  left_join(r_we_denom, by = 'name') %>% 
  mutate(share_est = estimate/denom_est,
         share_moe = moe_prop(estimate, denom_est, moe, denom_moe))

r_we_grp_fmt <- r_we_grp %>% 
  select(name, is_wrk, has_dis, estimate, moe, cv, starts_with('share'))

datatable(r_we_grp_fmt ) %>%
  formatRound(columns=c('estimate'), digits = 0) %>% 
  formatRound(columns=c('moe'), digits = 2) %>% 
  formatPercentage(6:8, 1)

```


```{r}

# r_we_denom <- r_we %>% 
#   filter(variable_sort %in% '01') %>% 
#   select(name, denom_est = estimate, denom_moe = moe)

r_we_dis <- r_we %>% 
  filter(!(variable_sort %in% exc_we_rows)) %>% 
  group_by(name, duration, has_dis) %>% 
  summarise(estimate = sum(estimate),
            moe = moe_sum(moe = moe, estimate = estimate)) %>%
  mutate(se = moe/1.645) %>% 
  mutate(cv = (se/estimate)) %>% 
  left_join(r_we_denom, by = 'name') %>% 
  mutate(share_est = estimate/denom_est,
         share_moe = moe_prop(estimate, denom_est, moe, denom_moe))

r_we_dis_fmt <- r_we_dis %>% 
  select(name, duration, has_dis, estimate, moe, cv, starts_with('share'))

datatable(r_we_dis_fmt) %>%
  formatRound(columns=c('estimate'), digits = 0) %>% 
  formatRound(columns=c('moe'), digits = 2) %>% 
  formatPercentage(6:8, 1)

```

